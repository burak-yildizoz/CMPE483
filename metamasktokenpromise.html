<!DOCTYPE html>
<html lang="en">
<head>
    <title>Browser Transactions</title>
    <script src="erc20tokenabi.js"> </script>
    <script src="bulottokenabi.js"> </script>
    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.0.0-beta.34/dist/web3.min.js"></script>
    <script>
        window.addEventListener('load', async () => {
            // Modern dapp browsers...
            if (window.ethereum) {
                window.web3 = new Web3(ethereum);
                try {
                    // Request account access if needed
                    await ethereum.enable();
                } catch (error) {
                    alert("Cannot access user ethereum account");
                }
            }
            // Legacy dapp browsers...
            else if (window.web3) {
                window.web3 = new Web3(web3.currentProvider);
            }
            // Non-dapp browsers...
            else {
                alert('Non-Ethereum browser detected. You should consider trying MetaMask!');
            }
        });

        function getERC20TokenAddr() {
            var contaddr = "0x0";
            var contaddrlist = document.getElementsByName("token");
            for (var i=0, size=contaddrlist.length; i<size; i++) {
                if(contaddrlist[i].checked) {
                    contaddr = contaddrlist[i].value;
                }
            }
            return contaddr;
        }

        function getBULOTAddr() {
            return "0xd2f4902Af91Ef3D38dbA55a23a1120A5565B8B20";  // period: 5 minutes
        }

        function gettokenbalance() {
            var contaddr = getERC20TokenAddr();
            var contract = new web3.eth.Contract(erc20tokenabi, contaddr);
            var fromaddr = document.getElementById("fromaddr").value;
            var mypromise = contract.methods.balanceOf(fromaddr).call();
            mypromise.then(
                function(result) {
                    document.getElementById("tokenstatus").innerHTML = "Balance:" + result;
                },
                function(err) {
                    console.log(err);
                }
            );
        }

        function getCurrentLotteryNo() {
            var contaddr = getBULOTAddr();
            var contract = new web3.eth.Contract(bulottokenabi, contaddr);
            var fromaddr = document.getElementById("fromaddr").value;
            var mypromise = contract.methods.getCurrentLotteryNo().call();
            mypromise.then(
                function(result) {
                    document.getElementById("weekstatus").innerHTML = "Current Lottery No: " + result;
                },
                function(err) {
                    console.log(err);
                }
            );
        }

    </script>
</head>

<body>
    <h1>Check Your Balances</h1>
    <form>
        <p> Owner Address: <textarea id="fromaddr" rows="1" cols="100" placeholder="0x0123456789ABCDEF0123456789abcdef01234567"></textarea> </p>
        <p> Token:<br>
            <input type="radio" id="token1" name="token" value=0x03207A15dE9B5A4d2BA11B2aa60Dc6272eA0b5BE>
                <label for="token1" checked>BUCOIN</label><br>
            <input type="radio" id="token2" name="token" value=0x12c25Bd781709166Fd24784eE7C03bFB93480699>
                <label for="token2">Turkish Lira</label><br>
        </p>
    </form>
    <button onclick="gettokenbalance()">Get Token Balance</button>
    <p id="tokenstatus"></p>
    <button onclick="getCurrentLotteryNo()">Get Current Week</button>
    <p id="weekstatus"></p>
</body>
</html>
